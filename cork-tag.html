<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="cork-tag">
  <template>
    <style>
      :host {
        display: inline-block;
      }

      .arrow {
        border-style: solid;
        width: 0;
        height: 0;
        display: inline-block;
      }

      #arrowRight {
        border-color: transparent transparent transparent var(--cork-tag-color, var(--secondary-accent-color, #cccccc));
      }

      #label {
        max-width: var(--cork-tag-max-width, initial);
        padding: 5px;
        background-color: var(--cork-tag-color, var(--secondary-accent-color, #cccccc));
      }

      #arrowLeftOuter {
        text-align: right;
      }

      #arrowLeft {
        border-color: transparent var(--cork-tag-color, var(--secondary-accent-color, #cccccc)) transparent transparent;
      }

    </style>
    
    <div style="display:flex; align-items: center">
      <div id="arrowLeftOuter" hidden$="[[rightArrow]]">
        <div id="arrowLeft" class="arrow"></div>
      </div>
      <div id="label"><slot></slot></div>
      <div id="arrowRightOuter" hidden$="[[!rightArrow]]">
        <div hidden$="[[!rightArrow]]" id="arrowRight" class="arrow"></div>
      </div>
    </div>

  </template>

  <script>

    class CorkTag extends Polymer.Element {
      static get is() { return 'cork-tag'; }

      static get properties() {
        return {
          rightArrow: {
            type: Boolean,
            value: false
          }
        };
      }

      constructor() {
        super();
        this._setBorderWidth = this._setBorderWidth.bind(this);
      }

      connectedCallback() {
        super.connectedCallback();
        window.addEventListener('resize', this._setBorderWidth);
        this._setBorderWidth();
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        window.removeEventListener('resize', this._setBorderWidth);
      }

      // update triangle size
      _setBorderWidth() {
        var h = this.$.label.offsetHeight;

        var height = (h/2);
        var equHeight = ((Math.sqrt(3)/2) * h) - (h * 0.30);

        this.$.arrowLeftOuter.style.width = (h - (h * 0.30))+'px';
        this.$.arrowLeftOuter.style.height = h+'px';
        this.$.arrowLeft.style.borderWidth = `${height}px ${equHeight}px ${height}px 0`;

        this.$.arrowRightOuter.style.width = (h - (h * 0.30))+'px';
        this.$.arrowRightOuter.style.height = h+'px';
        this.$.arrowRight.style.borderWidth = `${height}px 0 ${height}px ${equHeight}px`;
      }
    }

    window.customElements.define(CorkTag.is, CorkTag);
  </script>
</dom-module>
